<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
	crossorigin="anonymous">
<title>用户注册</title>
<style>
body {
	display: flex;
	justify-content: center;
	align-items: center;
	height: 100vh;
}

table {
	width: 400px;
	border: 1px solid black;
}

td {
	padding: 5px;
}

.button-cell {
	text-align: center; /* 按钮居中 */
}

.error-msg {
	color: red;
    font-family: SimSun;
    font-weight: bold;
    font-size: 20px;
}

.title-container {
	display: flex;
	align-items: center;
	margin-bottom: 20px;
}

.alert .bi {
	width: 16px;
	height: 16px;
}

.custom-info {
	padding: 4px 4px; /* 调整底板的上下边距 */
	font-size: 14px; /* 调整底板的字体大小 */
	text-align: center; /* 让文字水平居中 */
	fill: #0d6efd; /* 自定义图标的颜色 */
	background-color: transparent;
	border: none;
	box-shadow: none;
}
</style>
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="check-circle-fill" viewBox="0 0 16 16">
    <path
		d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
  </symbol>
  <symbol id="info-fill" viewBox="0 0 16 16">
    <path
		d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z" />
  </symbol>
  <symbol id="exclamation-triangle-fill" viewBox="0 0 16 16">
    <path
		d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z" />
  </symbol>
</svg>
</head>
<body>
	<form action="Hserv" method="post">

		<div class="row">
			<div class="col">
				<div class="title-container">

					<svg xmlns="http://www.w3.org/2000/svg" width="36" height="36"
						fill="currentColor" class="bi bi-person-plus-fill title-icon"
						viewBox="0 0 16 16">
       					<path
							d="M1 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" />
        				<path fill-rule="evenodd"
							d="M13.5 5a.5.5 0 0 1 .5.5V7h1.5a.5.5 0 0 1 0 1H14v1.5a.5.5 0 0 1-1 0V8h-1.5a.5.5 0 0 1 0-1H13V5.5a.5.5 0 0 1 .5-.5z" />
      				</svg>
					<h1>&nbsp;注册&nbsp;</h1>
				</div>
			</div>
			<div class="col d-flex justify-content-end">
				<button type="button" class="btn-close" aria-label="Close"></button>
			</div>
		</div>



		<div class="mb-3">
		    <label for="username" class="form-label">用户名</label>
		    <input type="text" class="form-control" id="username" name="username" oninput="checkUsername()">
		    <div id="usernameHelp" class="form-text">用户名长度需小于15位。</div>
		    <div id="usernameFeedback" class="invalid-feedback">
		        用户名已存在
		    </div>
		</div>
		<div class="mb-3">
		    <label for="password" class="form-label">密码</label>
		    <input type="password" class="form-control" id="password" name="password" oninput="checkPassword()">
		    <div id="passwordHelp" class="form-text">密码长度需在6-20位。</div>
		</div>
		<div class="mb-3">
			<label for="tel" class="form-label">电话</label> <input type="text"
				class="form-control" id="tel"
				aria-describedby="telHelp">
			<div id="telHelp" class="form-text">* 非必需填写</div>
		</div>
		<div class="mb-3">
			<label for="age" class="form-label">年龄</label> <input type="text"
				class="form-control" id="age"
				aria-describedby="ageHelp">
			<div id="ageHelp" class="form-text">* 非必须填写</div>
		</div>

		<div class="mb-1">
			<div
				class="alert alert-primary d-flex align-items-center text-primary custom-info"
				role="alert">
				<svg class="bi flex-shrink-0 me-2 text-primary" role="img"
					aria-label="Info:">
						      <use xlink:href="#info-fill" />
						    </svg>
				<div>
					已有账号?<a href="login.html" class="alert-link"
						style="--bs-link-opacity: .2"> 点我登陆 </a> 。
				</div>
			</div>
		</div>

		<table>
			<tr style="display: none;">
				<td>注册时间：</td>
				<td><input name="registration_time" type="datetime-local"
					value="" /></td>
			</tr>
		</table>

		<div class="d-flex justify-content-center gap-5 mb-2">
			<button type="submit" class="btn btn-primary btn-lg">&nbsp;&nbsp;提 交&nbsp;&nbsp;</button>
			<button type="reset" class="btn btn-secondary btn-lg">&nbsp;&nbsp;重 置&nbsp;&nbsp;</button>
		</div>

		<div class="d-flex justify-content-center">
			<div id="error-msg" class="error-msg" style="display: none;"></div>
		</div>

	</form>


<script>
	// 设置注册时间字段的值为当前时间
	const registrationTimeField = document
			.querySelector("input[name='registration_time']");
	const now = new Date();
	const isoString = now.toISOString().slice(0, 16); // 格式为：yyyy-MM-ddTHH:mm
	registrationTimeField.value = isoString;

	// 获取URL参数
	const urlParams = new URLSearchParams(window.location.search);
	// 获取用户名参数并设置为输入框的值
	const username = urlParams.get('username');
	document.getElementById('username').value = username;

	// 获取错误消息参数并显示错误消息
	const errorMessage = urlParams.get('errorMessage');
	if (errorMessage) {
		const errorElement = document.getElementById('error-msg');
		errorElement.textContent = errorMessage;
		errorElement.style.display = 'block';
	}

	// 关闭按钮点击事件
	document.querySelector('.btn-close').addEventListener('click', function() {
		window.location.href = 'http://localhost:8080/pdh-java-web/';
	});

	function checkUsername() {
	    const usernameInput = document.getElementById('username');
	    const usernameFeedback = document.getElementById('usernameFeedback');
	    const usernameValue = usernameInput.value.trim();

	    // 移除错误状态
	    usernameInput.classList.remove('is-invalid');
	    usernameFeedback.style.display = 'none';

	    // 发送异步请求检查用户名是否存在
	    fetch(`check_username?username=${encodeURIComponent(usernameValue)}`)
	        .then(response => response.json())
	        .then(data => {
	            if (data.exists) {
	                usernameInput.classList.add('is-invalid');
	                usernameFeedback.style.display = 'block';
	            } else {
	                usernameInput.classList.remove('is-invalid');
	                usernameInput.classList.add('is-valid');
	            }
	        })
	        .catch(error => {
	            console.error('Error:', error);
	        });
	}

    function checkPassword() {
        const passwordInput = document.getElementById('password');
        const passwordValue = passwordInput.value.trim();

        if (passwordValue.length < 6 || passwordValue.length > 20) {
            passwordInput.classList.add('is-invalid');
        } else {
            passwordInput.classList.remove('is-invalid');
            passwordInput.classList.add('is-valid');
        }
    }
    
	 // 监听用户名输入框点击事件，清空内容并重置状态
    document.getElementById('password').addEventListener('click', function() {
        const passwordInput = document.getElementById('password');

        passwordInput.value = '';
        passwordInput.classList.remove('is-valid', 'is-invalid');
    });
</script>

</body>
</html>
